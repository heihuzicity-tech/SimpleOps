# 运维堡垒机系统 - 项目架构图表集

## 📋 图表目录

1. [项目开发计划甘特图](#1-项目开发计划甘特图)
2. [系统功能模块关系图](#2-系统功能模块关系图)
3. [数据库实体关系图](#3-数据库实体关系图)
4. [SSH访问业务流程图](#4-ssh访问业务流程图)
5. [技术架构层次图](#5-技术架构层次图)
6. [项目目录结构图](#6-项目目录结构图)

---

## 1. 项目开发计划甘特图

### 📅 **用途说明**
展示MVP版本的完整开发时间线，包括4个主要阶段和16周的详细进度安排。

### 🎯 **关键信息**
- **第一阶段**: 核心MVP功能开发（12周）
- **第二阶段**: 前端界面开发（并行进行）
- **第三阶段**: 测试部署（2周）
- **第四阶段**: 功能扩展（8周）

```mermaid
gantt
    title 运维堡垒机MVP开发计划
    dateFormat  YYYY-MM-DD
    section 第一阶段：核心MVP
    项目基础搭建        :active, setup, 2024-01-01, 2w
    用户认证系统        :auth, after setup, 2w
    用户管理模块        :user, after auth, 2w
    资产管理模块        :asset, after user, 2w
    SSH访问代理        :ssh, after asset, 2w
    基础审计系统        :audit, after ssh, 2w
    
    section 第二阶段：界面开发
    前端基础界面        :frontend1, after user, 2w
    SSH终端界面        :frontend2, after ssh, 2w
    
    section 第三阶段：测试部署
    集成测试           :test, after audit, 1w
    文档编写           :doc, after test, 1w
    
    section 第四阶段：功能扩展
    RDP访问支持        :rdp, after doc, 2w
    权限策略优化        :policy, after rdp, 2w
    审计功能增强        :audit2, after policy, 2w
    命令控制           :cmd, after audit2, 2w
```

---

## 2. 系统功能模块关系图

### 📊 **用途说明**
展示运维堡垒机系统的整体架构和各模块之间的关系，包括后端、前端、数据存储三层架构。

### 🎯 **关键信息**
- **后端服务**: 6个核心模块（认证、管理、代理、审计）
- **前端界面**: 2个主要界面（管理界面、SSH终端）
- **数据存储**: 3类数据（用户、资产、会话）

```mermaid
graph TD
    A[运维堡垒机MVP] --> B[后端服务<br/>Go + Gin + GORM]
    A --> C[前端界面<br/>React + Ant Design]
    A --> D[数据存储<br/>MySQL + Redis]
    
    B --> E[用户认证模块<br/>JWT + 权限控制]
    B --> F[资产管理模块<br/>服务器 + 凭证]
    B --> G[SSH代理模块<br/>协议代理 + 会话]
    B --> H[审计模块<br/>日志 + 记录]
    
    C --> I[管理界面<br/>用户 + 资产管理]
    C --> J[SSH终端<br/>WebSSH + 会话]
    
    D --> K[用户数据<br/>users + roles]
    D --> L[资产数据<br/>assets + credentials]
    D --> M[会话数据<br/>sessions + logs]
    
    E --> N[登录认证<br/>用户名密码]
    E --> O[权限校验<br/>RBAC模型]
    
    F --> P[资产CRUD<br/>增删改查]
    F --> Q[连接测试<br/>SSH验证]
    
    G --> R[SSH协议<br/>代理转发]
    G --> S[会话管理<br/>创建销毁]
    
    H --> T[操作日志<br/>用户行为]
    H --> U[会话记录<br/>终端操作]
    
    style A fill:#e1f5fe
    style B fill:#f3e5f5
    style C fill:#e8f5e8
    style D fill:#fff3e0
```

---

## 3. 数据库实体关系图

### 🗃️ **用途说明**
展示MySQL数据库的核心表结构和表之间的关系，包括用户管理、资产管理、会话审计等数据模型。

### 🎯 **关键信息**
- **用户体系**: users, roles, user_roles（多对多关系）
- **资产体系**: assets, credentials（一对多关系）
- **审计体系**: sessions, operation_logs（关联用户和资产）

```mermaid
erDiagram
    USERS {
        bigint id PK "用户ID"
        varchar username UK "用户名"
        varchar password "密码"
        varchar email "邮箱"
        tinyint status "状态"
        timestamp created_at "创建时间"
    }
    
    ROLES {
        bigint id PK "角色ID"
        varchar name UK "角色名"
        text description "描述"
        json permissions "权限"
        timestamp created_at "创建时间"
    }
    
    USER_ROLES {
        bigint user_id PK "用户ID"
        bigint role_id PK "角色ID"
    }
    
    ASSETS {
        bigint id PK "资产ID"
        varchar name "资产名称"
        varchar type "资产类型"
        varchar address "IP地址"
        int port "端口"
        varchar protocol "协议"
        json tags "标签"
        tinyint status "状态"
        timestamp created_at "创建时间"
    }
    
    CREDENTIALS {
        bigint id PK "凭证ID"
        varchar name "凭证名"
        varchar type "凭证类型"
        varchar username "用户名"
        varchar password "密码"
        text private_key "私钥"
        bigint asset_id FK "资产ID"
        timestamp created_at "创建时间"
    }
    
    SESSIONS {
        bigint id PK "会话ID"
        varchar session_id UK "会话标识"
        bigint user_id FK "用户ID"
        bigint asset_id FK "资产ID"
        varchar protocol "协议"
        timestamp start_time "开始时间"
        timestamp end_time "结束时间"
        varchar status "会话状态"
        varchar client_ip "客户端IP"
        varchar record_file "录制文件"
    }
    
    OPERATION_LOGS {
        bigint id PK "日志ID"
        varchar session_id "会话ID"
        bigint user_id FK "用户ID"
        bigint asset_id FK "资产ID"
        varchar action "操作类型"
        text command "命令内容"
        text result "执行结果"
        varchar risk_level "风险级别"
        timestamp timestamp "时间戳"
    }
    
    USERS ||--o{ USER_ROLES : "用户角色"
    ROLES ||--o{ USER_ROLES : "角色权限"
    ASSETS ||--o{ CREDENTIALS : "资产凭证"
    USERS ||--o{ SESSIONS : "用户会话"
    ASSETS ||--o{ SESSIONS : "资产会话"
    USERS ||--o{ OPERATION_LOGS : "用户操作"
    ASSETS ||--o{ OPERATION_LOGS : "资产操作"
```

---

## 4. SSH访问业务流程图

### 🔄 **用途说明**
展示用户通过堡垒机进行SSH访问的完整业务流程，从登录认证到会话结束的全过程。

### 🎯 **关键信息**
- **认证流程**: 用户登录 → JWT验证 → 权限检查
- **连接流程**: 选择服务器 → 建立SSH连接 → 启动WebSSH
- **审计流程**: 记录操作 → 保存会话 → 释放资源

```mermaid
flowchart TD
    A[用户登录] --> B{认证成功?}
    B -->|否| C[登录失败]
    B -->|是| D[获取JWT Token]
    
    D --> E[选择目标服务器]
    E --> F{权限检查}
    F -->|无权限| G[访问拒绝]
    F -->|有权限| H[创建SSH会话]
    
    H --> I[获取服务器凭证]
    I --> J[建立SSH连接]
    J --> K{连接成功?}
    K -->|否| L[连接失败]
    K -->|是| M[启动WebSSH终端]
    
    M --> N[用户操作命令]
    N --> O[记录操作日志]
    O --> P[转发命令到目标服务器]
    P --> Q[返回执行结果]
    Q --> R[显示结果到终端]
    
    R --> S{继续操作?}
    S -->|是| N
    S -->|否| T[关闭SSH连接]
    
    T --> U[记录会话结束]
    U --> V[保存会话记录]
    V --> W[释放资源]
    
    style A fill:#e3f2fd
    style M fill:#e8f5e8
    style O fill:#fff3e0
    style V fill:#fce4ec
```

---

## 5. 技术架构层次图

### 🏗️ **用途说明**
展示系统的技术架构分层，从前端到后端再到数据层的完整技术栈和组件关系。

### 🎯 **关键信息**
- **前端层**: React + Ant Design + WebSSH终端
- **后端层**: Gin + JWT + GORM + SSH代理 + WebSocket
- **数据层**: MySQL + Redis + 本地文件存储
- **目标层**: Linux/Windows服务器

```mermaid
graph TB
    subgraph "前端层"
        A[React + Ant Design<br/>用户界面]
        B[WebSSH Terminal<br/>SSH终端]
        C[Axios<br/>HTTP客户端]
    end
    
    subgraph "后端层"
        D[Gin Web框架<br/>API服务]
        E[JWT中间件<br/>身份认证]
        F[GORM<br/>ORM框架]
        G[SSH代理<br/>协议转发]
        H[WebSocket<br/>实时通信]
    end
    
    subgraph "数据层"
        I[MySQL 8.0<br/>关系数据库]
        J[Redis<br/>缓存/会话]
        K[本地文件<br/>日志/录制]
    end
    
    subgraph "目标服务器"
        L[Linux服务器]
        M[Windows服务器]
    end
    
    A --> C
    B --> H
    C --> D
    D --> E
    D --> F
    D --> G
    H --> G
    E --> J
    F --> I
    G --> L
    G --> M
    D --> K
    
    style A fill:#e3f2fd
    style D fill:#f3e5f5
    style I fill:#e8f5e8
    style G fill:#fff3e0
```

---

## 6. 项目目录结构图

### 📁 **用途说明**
展示完整的项目文件和目录结构，包括后端Go服务和前端React应用的代码组织方式。

### 🎯 **关键信息**
- **后端结构**: 按MVC模式组织，包含models、controllers、services等
- **前端结构**: 按功能模块组织，包含components、pages、services等
- **配置文件**: docker-compose.yml用于部署配置

```mermaid
graph TD
    A[bastion/] --> B[backend/]
    A --> C[frontend/]
    A --> D[docker-compose.yml]
    A --> E[README.md]
    
    B --> F[main.go]
    B --> G[config/]
    B --> H[models/]
    B --> I[controllers/]
    B --> J[services/]
    B --> K[middleware/]
    B --> L[routers/]
    B --> M[utils/]
    
    G --> N[config.yaml]
    G --> O[database.go]
    
    H --> P[user.go]
    H --> Q[asset.go]
    H --> R[session.go]
    H --> S[log.go]
    
    I --> T[auth.go]
    I --> U[user.go]
    I --> V[asset.go]
    I --> W[ssh.go]
    I --> X[audit.go]
    
    J --> Y[auth_service.go]
    J --> Z[ssh_service.go]
    J --> AA[audit_service.go]
    
    K --> BB[jwt.go]
    K --> CC[cors.go]
    K --> DD[logger.go]
    
    L --> EE[routes.go]
    L --> FF[api.go]
    
    M --> GG[crypto.go]
    M --> HH[validator.go]
    
    C --> II[src/]
    C --> JJ[public/]
    C --> KK[package.json]
    
    II --> LL[components/]
    II --> MM[pages/]
    II --> NN[services/]
    II --> OO[utils/]
    
    LL --> PP[Header.tsx]
    LL --> QQ[Sidebar.tsx]
    LL --> RR[Terminal.tsx]
    
    MM --> SS[Login.tsx]
    MM --> TT[Dashboard.tsx]
    MM --> UU[AssetList.tsx]
    MM --> VV[UserList.tsx]
    MM --> WW[SSH.tsx]
    
    NN --> XX[api.ts]
    NN --> YY[auth.ts]
    
    OO --> ZZ[request.ts]
    OO --> AAA[constants.ts]
    
    style A fill:#e1f5fe
    style B fill:#f3e5f5
    style C fill:#e8f5e8
    style D fill:#fff3e0
```

---

## 📚 图表使用说明

### 1. **项目管理使用**
- **甘特图**: 用于项目进度跟踪和里程碑管理
- **流程图**: 用于业务流程梳理和需求分析
- **架构图**: 用于技术方案讨论和代码设计

### 2. **开发参考使用**
- **模块图**: 指导代码模块划分和接口设计
- **ER图**: 指导数据库设计和SQL编写
- **目录图**: 指导项目结构创建和文件组织

### 3. **文档维护**
- 随着项目发展，及时更新相关图表
- 新增功能时，补充对应的流程图和架构图
- 重要变更时，更新数据库ER图和目录结构图

### 4. **团队协作**
- 在技术评审时使用架构图和流程图
- 在需求讨论时使用功能模块图
- 在项目汇报时使用甘特图和进度图

---

## 🔧 图表编辑工具

### 在线编辑工具
- **Mermaid Live Editor**: https://mermaid.live/
- **Draw.io**: https://app.diagrams.net/
- **Lucidchart**: https://www.lucidchart.com/

### 本地编辑工具
- **VSCode + Mermaid Preview**: 安装Mermaid Preview插件
- **Typora**: 支持Mermaid语法的Markdown编辑器
- **Obsidian**: 支持Mermaid的知识管理工具

---

**这些图表将为项目开发提供清晰的指导和参考！** 📊✨ 