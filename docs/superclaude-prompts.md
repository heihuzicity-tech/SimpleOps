# SuperClaude 指令提示词记录文档

## 文档说明
本文档记录了在 Bastion 项目开发过程中使用的 SuperClaude 指令模板，便于复用和持续优化。

## SuperClaude 基础语法
- 指令格式：`/command --flags --persona-name`
- 常用命令：analyze, troubleshoot, improve, build, test, deploy
- 思考深度：--think, --think-hard, --ultrathink
- 常用人格：--persona-architect, --persona-backend, --persona-frontend, --persona-security, --persona-analyzer

## 指令模板库

### 1. Bug修复类指令

#### 1.1 会话审计重复记录Bug修复
**问题描述**：创建一个会话，但会话审计显示多个相同会话记录
**使用场景**：数据库记录重复，会话管理异常

```
/troubleshoot --prod --five-whys --persona-backend

【问题】会话审计显示重复会话记录 - 创建1个会话却显示多个相同会话
【症状】admin用户连接web-7主机显示4条相同记录，应该只显示1条活跃会话
【影响】审计数据不准确，无法正确监控实际会话状态

【分析方向】
1. 会话创建时是否重复插入数据库
2. WebSocket连接是否重复触发会话记录
3. 前端是否重复调用会话创建API
4. Redis会话管理是否存在重复存储
5. 数据库查询是否存在重复结果

【验证步骤】
- 检查backend/services/audit_service.go会话记录逻辑
- 查看backend/services/ssh_service.go会话创建流程
- 分析前端会话管理状态
- 检查数据库会话表重复记录原因

立即开始根因分析和修复
```

#### 1.2 深度分析指令（配合使用）
```
/analyze --code --think-hard --persona-architect

【任务】系统性分析会话审计重复记录问题
【范围】Bastion WebSSH会话管理全链路
【重点】会话生命周期管理和数据一致性

/improve --performance --iterate --persona-backend

【目标】优化会话记录机制，确保一个会话对应一条记录
【约束】保持现有Docker架构和API兼容性
```

### 2. 具体问题场景指令

#### 2.1 SSH连接失败问题
**问题描述**：用户点击连接按钮后，WebSSH终端无法建立连接，显示连接超时错误
**使用场景**：网络连接问题、SSH服务异常、认证失败

```
/troubleshoot --prod --five-whys --persona-backend

【问题】WebSSH终端连接失败 - 用户无法通过web界面连接到目标服务器
【症状】点击连接按钮后显示"连接超时"或"认证失败"错误
【影响】用户无法使用核心功能，影响运维工作效率

【分析方向】
1. 目标服务器SSH服务状态检查
2. 网络连通性测试（防火墙、端口）
3. SSH密钥认证配置验证
4. WebSocket连接状态分析
5. 后端SSH客户端连接逻辑检查

【验证步骤】
- 检查backend/services/ssh_service.go连接逻辑
- 验证SSH密钥配置和权限
- 测试网络连通性和端口访问
- 查看WebSocket连接状态和错误日志

立即开始连接问题诊断
```

#### 2.2 用户权限管理问题
**问题描述**：需要为不同角色用户分配不同的服务器访问权限，当前所有用户都能访问所有服务器
**使用场景**：权限控制、角色管理、安全加固

```
/design --api --ddd --persona-architect

【需求】实现基于角色的用户权限管理系统
【目标】不同角色用户只能访问授权的服务器资源
【约束】保持现有用户体验，不影响管理员操作

【设计要点】
1. 用户角色定义（管理员、运维、开发、只读）
2. 服务器资源分组管理
3. 权限映射关系设计
4. 前端权限控制界面
5. 后端权限验证逻辑

【实现步骤】
- 设计数据库权限表结构
- 实现后端权限验证中间件
- 开发前端权限管理界面
- 添加用户角色分配功能

开始权限系统架构设计
```

#### 2.3 实时监控功能开发
**问题描述**：需要添加实时会话监控功能，让管理员能够实时查看所有用户的操作行为
**使用场景**：安全审计、实时监控、合规要求

```
/build --feature --tdd --persona-backend

【功能】实时会话监控系统
【描述】管理员可以实时查看所有活跃SSH会话的操作内容
【技术要求】WebSocket实时传输、会话录屏、操作记录

【功能模块】
1. 会话监控后端服务
2. WebSocket实时数据传输
3. 前端监控界面展示
4. 会话操作记录存储
5. 监控权限控制

【开发计划】
- 实现会话监控WebSocket服务
- 开发会话数据采集逻辑
- 创建实时监控前端界面
- 添加会话录屏功能
- 实现操作审计日志

开始实时监控功能开发
```

#### 2.4 系统性能优化
**问题描述**：系统在高并发情况下响应缓慢，多个用户同时连接时出现卡顿和连接失败
**使用场景**：性能优化、并发处理、资源管理

```
/improve --performance --iterate --persona-performance

【问题】高并发场景下系统性能瓶颈
【现状】20个用户同时连接时出现明显延迟和偶发连接失败
【目标】支持100+并发用户稳定访问

【优化方向】
1. 数据库连接池优化
2. Redis缓存策略改进
3. WebSocket连接管理优化
4. 前端状态管理优化
5. 服务器资源配置调整

【性能指标】
- 响应时间：<500ms
- 并发用户：100+
- 连接成功率：>99.9%
- 内存使用：<2GB
- CPU使用率：<80%

开始性能瓶颈分析和优化
```

#### 2.5 安全漏洞修复
**问题描述**：发现系统存在潜在的安全漏洞，需要进行全面的安全审计和加固
**使用场景**：安全加固、漏洞修复、合规检查

```
/analyze --code --think-hard --persona-security

【任务】Bastion系统安全漏洞审计和加固
【范围】全系统安全评估，包括认证、授权、数据传输、存储
【重点】SSH密钥管理、会话安全、数据加密、访问控制

【安全检查项】
1. 认证机制安全性评估
2. SSH密钥存储和管理
3. 会话数据加密传输
4. 用户权限控制验证
5. 审计日志安全性
6. 敏感数据保护

【合规要求】
- 符合等保2.0要求
- 满足企业安全策略
- 通过渗透测试验证

立即开始安全审计分析
```

### 3. 常用指令模板

#### 3.1 基础故障排查
```
/troubleshoot --prod --five-whys --persona-analyzer
```

#### 3.2 代码分析
```
/analyze --code --think --persona-architect
```

#### 3.3 性能优化
```
/improve --performance --iterate --persona-performance
```

#### 3.4 安全审查
```
/analyze --code --think-hard --persona-security
```

#### 3.5 完整开发流程
```
/design --api --ddd --persona-architect
/build --feature --tdd --persona-backend
/test --coverage --e2e --persona-qa
/deploy --env staging --plan
```

## 问题描述格式化模板

### 基础问题描述模板
```
【问题】简洁的问题标题
【症状】具体的现象描述
【影响】对系统或用户的影响
【复现步骤】（可选）
【环境信息】（可选）
【期望结果】（可选）
```

### 功能开发描述模板
```
【需求】功能需求描述
【目标】要达到的效果
【约束】技术或业务限制
【设计要点】主要设计考虑
【实现步骤】具体实现计划
```

### 性能问题描述模板
```
【问题】性能问题描述
【现状】当前性能指标
【目标】期望性能目标
【优化方向】可能的优化点
【性能指标】具体的量化指标
```

### 安全问题描述模板
```
【任务】安全审计或加固任务
【范围】审计范围
【重点】重点检查项
【安全检查项】具体检查内容
【合规要求】相关合规标准
```

## 使用指南

### 选择原则
1. **简单bug**：使用单个/troubleshoot指令
2. **复杂系统问题**：组合多个指令（analyze → troubleshoot → improve）
3. **紧急问题**：添加--prod标志
4. **深度分析**：使用--think-hard或--ultrathink
5. **新功能开发**：使用/design和/build组合
6. **性能优化**：使用/improve配合具体指标

### 人格选择建议
- **architect**：系统设计、架构问题
- **backend**：后端逻辑、API问题
- **frontend**：前端界面、交互问题
- **security**：安全漏洞、权限问题
- **analyzer**：问题分析、根因定位
- **qa**：测试相关、质量保证
- **performance**：性能优化、效率提升

### 指令组合策略
- **故障排查**：/troubleshoot → /analyze → /improve
- **新功能开发**：/design → /build → /test → /deploy
- **性能优化**：/analyze → /improve → /test
- **安全审计**：/analyze → /troubleshoot → /improve

## 更新记录
- 2025-07-14：创建文档，添加会话审计bug修复指令模板
- 2025-07-14：添加5个具体问题场景指令示例和问题描述格式化模板
- 待更新：根据实际使用情况持续补充新的指令模板

## 注意事项
- 所有指令都应该结合具体的问题描述和项目背景
- 使用前确保已经了解SuperClaude的最新功能和语法
- 定期更新指令模板以保持最佳实践