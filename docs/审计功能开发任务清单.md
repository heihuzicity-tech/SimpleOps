# 审计功能开发任务清单

## 开发阶段规划

### 第一阶段：基础界面开发（高优先级）
> 完善前端基础审计功能界面

#### 1.1 操作日志管理界面
- [ ] **前端组件开发**
  - 创建操作日志列表组件
  - 实现搜索和筛选功能
  - 添加分页和排序
  - 操作详情弹窗展示
- [ ] **API集成**
  - 集成 `GET /audit/operation-logs` 接口
  - 集成 `GET /audit/operation-logs/{id}` 接口
- [ ] **功能特性**
  - 按用户名、操作类型、时间范围筛选
  - 状态码高亮显示
  - 操作耗时统计

#### 1.2 登录日志查看界面  
- [ ] **前端组件开发**
  - 创建登录日志列表组件
  - 实现失败登录高亮
  - 添加IP地址和地理位置显示
- [ ] **API集成**
  - 集成 `GET /audit/login-logs` 接口
- [ ] **功能特性**
  - 登录成功/失败状态区分
  - 异常登录IP告警显示
  - 登录趋势图表

#### 1.3 会话记录管理界面
- [ ] **前端组件开发**
  - 创建会话记录列表组件
  - 实现会话状态显示
  - 添加会话持续时间计算
- [ ] **API集成**
  - 集成 `GET /audit/session-records` 接口
  - 集成 `GET /audit/session-records/{id}` 接口
- [ ] **功能特性**
  - 活跃/已结束会话状态区分
  - 会话时长统计
  - 资产访问频率分析

#### 1.4 命令日志查看界面
- [ ] **前端组件开发**
  - 创建命令日志列表组件
  - 实现风险等级色彩标识
  - 添加命令搜索功能
- [ ] **API集成**
  - 集成 `GET /audit/command-logs` 接口
  - 集成 `GET /audit/command-logs/{id}` 接口
- [ ] **功能特性**
  - 危险命令红色警告
  - 命令执行时间和结果显示
  - 按会话ID关联查看

### 第二阶段：实时监控功能（高优先级）
> 实现在线会话实时监控

#### 2.1 后端WebSocket服务
- [ ] **WebSocket服务器**
  - 实现WebSocket连接管理
  - 添加会话状态广播
  - 实现客户端认证
- [ ] **实时数据推送**
  - 活跃会话状态更新
  - 新会话连接通知
  - 会话断开通知

#### 2.2 实时会话监控界面
- [ ] **前端WebSocket客户端**
  - 实现WebSocket连接管理
  - 添加断线重连机制
  - 实现消息处理
- [ ] **监控界面组件**
  - 活跃会话实时列表
  - 会话详情实时更新
  - 会话地理位置图
- [ ] **管理功能**
  - 强制终止会话按钮
  - 会话警告发送
  - 批量会话管理

#### 2.3 新增API接口
- [ ] **活跃会话API**
  - `GET /audit/active-sessions` - 获取活跃会话
  - `POST /audit/sessions/{id}/terminate` - 强制终止会话
  - `POST /audit/sessions/{id}/warning` - 发送会话警告

### 第三阶段：会话回放功能（中优先级）
> 实现历史会话的详细回放

#### 3.1 会话录制存储
- [ ] **录制功能扩展**
  - 扩展SSH服务录制功能
  - 实现录制文件存储
  - 添加录制文件索引
- [ ] **存储配置**
  - 配置录制文件存储路径
  - 实现文件压缩和清理
  - 添加文件大小限制

#### 3.2 回放播放器
- [ ] **Linux会话回放**
  - 实现终端操作回放
  - 支持命令高亮显示
  - 添加播放控制（播放/暂停/快进）
- [ ] **Windows会话回放**
  - 实现RDP会话录制（如支持）
  - 视频格式播放器
  - 截图关键帧显示

#### 3.3 回放API接口
- [ ] **回放数据API**
  - `GET /audit/sessions/{id}/replay` - 获取回放数据
  - `GET /audit/sessions/{id}/recording` - 下载录制文件
  - `GET /audit/sessions/{id}/timeline` - 获取时间轴数据

### 第四阶段：告警和统计功能（中优先级）
> 增强审计数据分析和告警能力

#### 4.1 实时告警系统
- [ ] **告警规则配置**
  - 危险命令执行告警
  - 异常登录行为告警
  - 会话异常时长告警
- [ ] **告警通知**
  - 邮件告警通知
  - 系统内消息通知
  - 钉钉/企业微信集成（可选）

#### 4.2 审计统计分析
- [ ] **统计图表**
  - 登录趋势图
  - 操作热力图
  - 会话时长分布
  - 命令风险分布
- [ ] **API集成增强**
  - 扩展 `GET /audit/statistics` 接口
  - 添加时间范围统计
  - 增加用户行为分析

### 第五阶段：高级功能（低优先级）
> 提升用户体验和系统可用性

#### 5.1 高级搜索和导出
- [ ] **高级搜索**
  - 多条件组合搜索
  - 保存搜索条件
  - 搜索历史记录
- [ ] **数据导出**
  - Excel格式导出
  - PDF报告生成
  - 定期报告邮件

#### 5.2 系统优化
- [ ] **性能优化**
  - 分页性能优化
  - 索引策略优化
  - 缓存机制添加
- [ ] **用户体验**
  - 移动端适配
  - 快捷键支持
  - 主题切换支持

## 开发时间估算

### 第一阶段：2-3周
- 操作日志界面：3-4天
- 登录日志界面：2-3天  
- 会话记录界面：3-4天
- 命令日志界面：4-5天
- 界面集成和测试：2-3天

### 第二阶段：2-3周
- WebSocket服务：4-5天
- 实时监控界面：5-6天
- API接口开发：2-3天
- 集成测试：2-3天

### 第三阶段：3-4周
- 录制存储：5-7天
- 回放播放器：7-10天
- API接口：3-4天
- 测试优化：3-4天

### 第四阶段：2-3周
- 告警系统：5-7天
- 统计分析：4-5天
- 测试集成：2-3天

### 第五阶段：2-3周
- 高级功能：7-10天
- 系统优化：4-5天
- 整体测试：2-3天

## 技术依赖

### 前端依赖
- WebSocket客户端库
- 图表库（如 ECharts、Chart.js）
- 视频播放器库（如 Video.js）
- 终端模拟器库（如 xterm.js）

### 后端依赖  
- WebSocket库（Gorilla WebSocket）
- 文件存储库
- 邮件发送库
- 定时任务库

### 基础设施
- 文件存储空间
- 邮件服务配置
- 监控告警配置

## 测试计划

### 单元测试
- [ ] API接口测试
- [ ] 前端组件测试
- [ ] WebSocket连接测试

### 集成测试
- [ ] 端到端功能测试
- [ ] 性能压力测试
- [ ] 告警功能测试

### 用户验收测试
- [ ] 管理员功能测试
- [ ] 普通用户权限测试
- [ ] 异常场景测试

---

*请按照优先级顺序进行开发，确保核心功能优先完成*