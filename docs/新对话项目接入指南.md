# Bastion项目新对话接入指南

**版本**: v2.0  
**更新时间**: 2025-07-15  
**适用于**: Claude Code 新对话快速接入

---

## 🚀 快速接入提示词

> **复制以下提示词到新对话中，快速让Claude了解项目状态**

```
我正在开发企业级运维堡垒机系统Bastion，需要你帮助我继续开发。

## 📊 项目现状快照
- **完成度**: 91.8% (重构成功完成)
- **技术栈**: Go 1.21 + Gin + React 18 + TypeScript + Ant Design + MySQL 8.0 + Redis
- **架构**: 前后端分离，微服务架构，Docker容器化
- **工作目录**: /Users/skip/workspace/bastion

## ✅ 已完成核心功能
- **用户认证系统** (100%) - JWT认证、RBAC权限控制
- **资产管理系统** (95%) - 服务器、凭证、分组管理
- **SSH终端功能** (100%) - WebSSH终端、会话管理
- **审计系统** (85%) - 操作、命令、会话、登录审计
- **实时监控** (95%) - WebSocket实时会话监控

## 🏗️ 架构重构成果
- **服务分层** - Controller/Service/Model清晰分离
- **接口抽象** - AssetProvider、SessionManager等接口实现
- **会话统一** - Redis统一存储，WebSocket实时通信
- **组件复用** - 前端80%组件复用率
- **代码质量** - 重复代码减少75%，整体质量73%

## 🔥 当前优先任务
1. **修复SSH安全漏洞** (高危) - backend/services/ssh_service.go:156 InsecureIgnoreHostKey
2. **完善登录日志界面** (中优) - 创建LoginLogsTable组件
3. **添加WebSocket超时** (中危) - 防止连接内存泄漏

## 📋 开发环境
- **启动命令**: ./manage.sh start
- **服务状态**: ./manage.sh status  
- **查看日志**: ./manage.sh logs [service]
- **前端开发**: cd frontend && npm run dev
- **后端开发**: cd backend && go run main.go

## 📚 关键文档位置
- 当前任务: docs/当前开发任务清单.md
- 开发计划: docs/后续开发计划.md
- 项目评估: docs/项目重构评估总结.md
- API指南: docs/API使用指南.md

请帮我处理当前最高优先级的任务。
```

---

## 📋 详细项目信息 (供参考)

### 🏗️ 项目架构概览

#### 后端架构 (Go)
```
backend/
├── controllers/     # API控制器层
├── services/        # 业务逻辑层
├── models/          # 数据模型层
├── interfaces/      # 服务接口抽象
├── utils/           # 工具类库
├── middleware/      # 中间件
└── config/          # 配置管理
```

#### 前端架构 (React + TypeScript)
```
frontend/src/
├── components/      # 可复用组件
├── pages/           # 页面组件
├── hooks/           # 自定义Hook
├── services/        # API服务层
├── store/           # Redux状态管理
└── types/           # TypeScript类型定义
```

### 🔑 核心技术特性

#### 安全认证
- JWT Token认证机制
- 基于角色的权限控制(RBAC)
- Token黑名单机制
- WebSocket认证支持

#### 会话管理
- Redis统一会话存储
- WebSocket实时状态同步
- 自动会话清理机制
- 会话生命周期管理

#### 审计体系
- 操作日志：完整的API调用记录
- 命令日志：SSH命令执行记录和风险评估
- 会话记录：完整的会话生命周期追踪
- 登录日志：用户登录行为记录

#### 实时监控
- WebSocket实时通信
- 活跃会话监控
- 强制会话终止
- 会话警告发送

### 📊 项目质量指标

#### 代码质量 (73% - 3.65/5)
- **架构设计**: 4/5 - 分层清晰，接口抽象好
- **后端质量**: 4/5 - Go规范性好，API设计合理
- **前端质量**: 3.5/5 - React组件设计合理
- **安全性**: 3.3/5 - 需要修复SSH安全配置
- **测试覆盖**: 2/5 - 需要大幅提升

#### 功能完整性 (85%)
- **基础功能**: 100% - 认证、资产、SSH终端完整
- **审计功能**: 85% - 核心审计完成，高级功能待实现
- **监控功能**: 95% - 实时监控基本完善
- **扩展功能**: 40% - 回放、地理位置等待开发

### ⚠️ 已知问题和风险

#### 🔴 高优先级问题
1. **SSH安全漏洞** - 使用InsecureIgnoreHostKey跳过主机密钥验证
2. **WebSocket内存泄漏** - 缺乏连接超时和清理机制
3. **测试覆盖率低** - 仅15%，远低于70%目标

#### 🟡 中优先级问题
1. **错误处理不统一** - 缺乏标准化错误码
2. **登录日志界面缺失** - 后端完整，前端待实现
3. **会话回放功能** - 架构预留，播放器待开发

#### 🟢 低优先级改进
1. **性能优化** - 数据库查询和前端渲染优化
2. **高级分析** - 用户行为分析和智能告警
3. **扩展功能** - 多协议支持和云原生部署

### 🎯 下一步开发重点

#### 本周任务 (必须完成)
1. **修复SSH安全配置** - 替换InsecureIgnoreHostKey
2. **创建登录日志界面** - LoginLogsTable组件
3. **添加WebSocket超时** - 防止内存泄漏

#### 下周任务 (重要)
1. **会话警告发送界面** - SessionWarningModal组件
2. **错误处理标准化** - 统一错误码和消息
3. **基础单元测试** - 核心服务测试覆盖

#### 月度目标 (规划)
1. **会话回放功能** - 录制存储和播放器
2. **地理位置服务** - IP定位和地图显示
3. **邮件告警系统** - 自动化安全通知

---

## 🛠️ 开发环境快速设置

### 环境要求
```bash
# 必要软件版本
Go 1.21+
Node.js 18+
MySQL 8.0
Redis 6.0+
Docker & Docker Compose
```

### 快速启动
```bash
# 1. 进入项目目录
cd /Users/skip/workspace/bastion

# 2. 启动所有服务
./manage.sh start

# 3. 检查服务状态
./manage.sh status

# 4. 前端开发模式 (可选)
cd frontend && npm run dev

# 5. 查看日志 (调试时)
./manage.sh logs backend
./manage.sh logs frontend
```

### 常用命令
```bash
# 服务管理
./manage.sh start|stop|restart|status
./manage.sh logs [service]
./manage.sh build

# 开发调试
cd frontend && npm run dev     # 前端热重载
cd backend && go run main.go   # 后端开发模式

# 代码检查
golangci-lint run              # Go代码检查
npm run lint                   # 前端代码检查
```

---

## 📚 重要文档索引

### 开发指导文档
- **当前任务**: `docs/当前开发任务清单.md` - 具体开发任务和优先级
- **开发计划**: `docs/后续开发计划.md` - 3-6个月详细规划
- **API指南**: `docs/API使用指南.md` - 后端API接口文档
- **前端指南**: `docs/前端开发指南.md` - 前端开发规范

### 业务需求文档  
- **需求分析**: `docs/运维堡垒机系统需求分析文档.md` - 业务需求
- **审计规范**: `docs/审计功能规范文档.md` - 审计功能设计
- **审计任务**: `docs/审计功能开发任务清单.md` - 审计功能开发计划

### 项目管理文档
- **项目评估**: `docs/项目重构评估总结.md` - 重构成果评估
- **问题记录**: `docs/问题解决记录.md` - 技术问题和解决方案
- **架构图表**: `docs/项目架构图表集.md` - 系统架构设计图

### 运维文档
- **数据库指南**: `docs/数据库导入指南.md` - 数据库配置
- **故障排查**: `docs/WebSSH终端故障排查文档.md` - 问题诊断

---

## 💡 最佳实践建议

### 代码开发
1. **安全优先** - 所有修改都要考虑安全影响
2. **测试驱动** - 重要功能需要添加单元测试
3. **文档同步** - 代码变更及时更新相关文档
4. **小步迭代** - 功能拆解为小任务，频繁提交

### 问题调试
1. **查看日志** - `./manage.sh logs [service]` 
2. **检查状态** - `./manage.sh status`
3. **重启服务** - `./manage.sh restart [service]`
4. **查阅文档** - 优先查看docs目录相关文档

### 协作开发
1. **任务确认** - 开始前确认任务优先级和要求
2. **进度同步** - 定期汇报开发进度和遇到的问题
3. **代码审查** - 重要修改建议经过代码审查
4. **文档维护** - 完成任务后更新相关文档

---

**使用建议**: 新对话开始时，复制"快速接入提示词"部分即可让Claude快速了解项目状态。根据具体需要处理的任务，可以补充引用相关的详细信息。