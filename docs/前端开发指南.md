# 前端开发指南

## 概述

运维堡垒机前端系统基于React 18 + TypeScript构建，采用现代化的前端技术栈，提供企业级的用户界面和用户体验。

## 技术栈

### 核心技术
- **React 18**: 现代化的前端框架
- **TypeScript**: 类型安全的JavaScript
- **Ant Design**: 企业级UI组件库
- **Redux Toolkit**: 状态管理和API缓存
- **React Router v6**: 现代化的路由系统
- **Axios**: HTTP客户端

### 开发工具
- **Vite**: 快速的构建工具
- **ESLint**: 代码规范检查
- **Prettier**: 代码格式化
- **Jest**: 单元测试框架

## 项目结构

```
frontend/
├── src/
│   ├── components/         # 通用组件
│   │   ├── DashboardLayout.tsx   # 主布局组件
│   │   └── ...
│   ├── pages/              # 页面组件
│   │   ├── LoginPage.tsx         # 登录页面
│   │   ├── UsersPage.tsx         # 用户管理页面
│   │   ├── AssetsPage.tsx        # 资产管理页面
│   │   └── ...
│   ├── services/           # API服务
│   │   ├── authAPI.ts            # 认证API
│   │   ├── userAPI.ts            # 用户API
│   │   ├── assetAPI.ts           # 资产API
│   │   └── ...
│   ├── store/              # Redux状态管理
│   │   ├── authSlice.ts          # 认证状态
│   │   ├── userSlice.ts          # 用户状态
│   │   ├── assetSlice.ts         # 资产状态
│   │   └── store.ts              # Store配置
│   ├── types/              # TypeScript类型定义
│   │   ├── auth.ts               # 认证相关类型
│   │   ├── user.ts               # 用户相关类型
│   │   └── ...
│   ├── utils/              # 工具函数
│   │   ├── request.ts            # HTTP请求配置
│   │   └── ...
│   ├── App.tsx             # 应用根组件
│   └── main.tsx            # 应用入口
├── package.json
├── tsconfig.json
└── vite.config.ts
```

## 已完成功能

### 1. 用户认证系统 ✅
- **登录界面**: 响应式登录表单，支持用户名/密码认证
- **JWT认证**: 自动Token管理和刷新
- **登录状态**: 登录状态持久化和自动恢复
- **退出登录**: 安全的登出流程

### 2. 布局系统 ✅
- **响应式布局**: 适配不同屏幕尺寸的管理后台布局
- **导航菜单**: 侧边栏导航菜单，支持图标和路由
- **头部导航**: 用户信息、退出登录等功能
- **面包屑导航**: 自动生成的面包屑导航

### 3. 用户管理 ✅
- **用户列表**: 分页显示用户列表，支持搜索和筛选
- **用户创建**: 表单验证的用户创建功能
- **用户编辑**: 行内编辑和弹框编辑支持
- **用户删除**: 软删除功能
- **状态管理**: 用户状态切换（启用/禁用）

### 4. 资产管理 ✅
- **资产列表**: 分页显示资产列表
- **资产创建**: 支持多种资产类型的创建
- **资产编辑**: 完整的资产信息编辑
- **资产删除**: 软删除功能
- **连接测试**: 资产连接状态测试

## 数据流架构

### API集成
```typescript
// API服务层
export const authAPI = {
  login: (credentials: LoginCredentials) => request.post('/auth/login', credentials),
  logout: () => request.post('/logout'),
  getProfile: () => request.get('/profile'),
  changePassword: (data: ChangePasswordData) => request.post('/change-password', data)
};

// Redux Slice
export const authSlice = createSlice({
  name: 'auth',
  initialState,
  reducers: {
    // 同步actions
  },
  extraReducers: (builder) => {
    builder
      .addCase(loginAsync.fulfilled, (state, action) => {
        state.isAuthenticated = true;
        state.user = action.payload.user;
        state.token = action.payload.token;
      })
      // 其他异步actions
  }
});
```

### 状态管理
- **认证状态**: 用户登录状态、用户信息、Token管理
- **用户状态**: 用户列表、角色列表、权限信息
- **资产状态**: 资产列表、凭证信息、连接状态
- **UI状态**: 加载状态、错误信息、表单状态

## 常见问题解决方案

### 1. React Router升级问题
**问题**: React Router v6废弃警告
**解决方案**: 添加future flags配置
```typescript
// App.tsx
<BrowserRouter future={{ v7_relativeSplatPath: true, v7_startTransition: true }}>
  <Routes>
    <Route path="/*" element={<AppRoutes />} />
  </Routes>
</BrowserRouter>
```

### 2. 前后端数据格式不一致
**问题**: 后端返回`{success: true, data: {...}}`格式，前端期望直接的数据
**解决方案**: 在API响应处理中统一数据格式
```typescript
// userSlice.ts
.addCase(fetchUsers.fulfilled, (state, action) => {
  // 处理后端返回的嵌套数据格式
  if (action.payload.success && action.payload.data) {
    state.users = action.payload.data.users || [];
    state.roles = action.payload.data.roles || [];
  }
})
```

### 3. 用户状态数据类型不匹配
**问题**: 前端发送字符串状态，后端期望数字状态
**解决方案**: 在提交前进行数据转换
```typescript
// 提交时转换状态格式
const submitData = {
  ...values,
  status: values.status === 'active' ? 1 : 0
};
```

### 4. 图标导入错误
**问题**: 导入不存在的Ant Design图标
**解决方案**: 使用正确的图标名称
```typescript
// 错误
import { TerminalOutlined } from '@ant-design/icons';

// 正确
import { ConsoleSqlOutlined } from '@ant-design/icons';
```

### 5. API端点路径问题
**问题**: 前端API路径与后端不一致
**解决方案**: 统一API路径配置
```typescript
// authAPI.ts
export const authAPI = {
  login: (credentials: LoginCredentials) => request.post('/auth/login', credentials),
  logout: () => request.post('/logout'),  // 注意：不是/auth/logout
  getProfile: () => request.get('/profile'),  // 注意：不是/auth/profile
  changePassword: (data: ChangePasswordData) => request.post('/change-password', data)
};
```

## 开发中功能

### 1. SSH终端界面 🚧
- **WebSSH终端**: 基于xterm.js的终端界面
- **会话管理**: SSH会话列表和管理
- **实时连接**: WebSocket实时通信
- **终端配置**: 终端主题、字体、大小配置

### 2. 审计日志界面 🚧
- **日志查看**: 各类审计日志的查看界面
- **日志筛选**: 按时间、用户、操作类型筛选
- **日志导出**: 审计日志导出功能
- **统计报表**: 审计数据统计和图表展示

### 3. 权限控制系统 🚧
- **路由权限**: 基于角色的路由访问控制
- **组件权限**: 组件级别的权限控制
- **按钮权限**: 按钮级别的权限控制
- **数据权限**: 数据级别的权限控制

## 开发指南

### 1. 环境配置
```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 构建生产版本
npm run build

# 运行测试
npm run test
```

### 2. 添加新页面
1. 在`src/pages/`目录创建新的页面组件
2. 在`src/services/`目录添加相应的API服务
3. 在`src/store/`目录添加状态管理slice
4. 在`src/types/`目录添加TypeScript类型定义
5. 在路由配置中添加新路由

### 3. 调试技巧
- 使用Redux DevTools查看状态变化
- 使用React DevTools调试组件
- 使用Network面板调试API请求
- 使用Console查看错误信息

### 4. 代码规范
- 使用TypeScript进行类型检查
- 遵循ESLint代码规范
- 使用Prettier格式化代码
- 编写单元测试

## 部署说明

### 1. 开发环境
```bash
npm run dev
```
访问: http://localhost:3000

### 2. 生产环境
```bash
npm run build
npm run preview
```

### 3. Docker部署
```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build
EXPOSE 3000
CMD ["npm", "run", "preview"]
```

## 性能优化

### 1. 代码分割
- 使用React.lazy()进行组件懒加载
- 路由级别的代码分割
- 第三方库的按需加载

### 2. 缓存策略
- Redux Toolkit Query API缓存
- 组件级别的缓存
- 静态资源缓存

### 3. 渲染优化
- 使用React.memo()避免不必要的重渲染
- 使用useMemo()和useCallback()优化计算
- 虚拟滚动处理大量数据

## 未来规划

1. **移动端适配**: 响应式设计的移动端优化
2. **国际化**: 多语言支持
3. **主题系统**: 可配置的主题系统
4. **离线支持**: PWA和离线功能
5. **实时通知**: WebSocket实时通知系统 