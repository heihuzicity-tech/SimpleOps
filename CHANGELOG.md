# 变更日志

所有对运维堡垒机系统的重要更改都将记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/zh-CN/1.0.0/)，
并且本项目遵循 [语义化版本控制](https://semver.org/lang/zh-CN/)。

## [未发布]

### 新增
- 🚀 **远程连接重构** - 全新的会话管理和远程连接体验
  - 创建独立的SSH终端连接页面（/connect/terminal/:sessionId）
  - 实现凭证选择对话框，支持智能凭证匹配
  - 添加快速访问功能，记录最近连接的主机
  - 集成连接测试功能到会话管理页面
  - 支持系统类型和连接状态筛选
- 🎨 **用户体验优化** - 重新设计的连接流程
  - 分离资产管理和会话连接的职责
  - 优化终端页面，提供全屏沉浸式体验
  - 添加连接状态实时显示和会话时长统计
  - 支持最近连接历史和一键重连

### 修复
- 🔧 **SSH连接功能恢复** - 修复会话连接中断的问题
  - 重新整理SSH会话创建流程
  - 修复WebSocket连接配置问题
  - 优化终端组件在独立页面中的显示
- 🔧 **路由重构** - 更新页面路由结构
  - 会话管理路由：/sessions/* → /connect/*
  - 添加独立终端页面路由：/connect/terminal/:sessionId
  - 保持向后兼容，自动重定向旧路由
- 🔧 **资产管理系统修复** - 解决资产创建和管理功能的关键问题
  - 修复前后端字段名称不匹配问题（host → address）
  - 修复前端API响应格式与后端不一致导致的数组操作错误
  - 修复标签字段JSON格式处理问题
  - 增强Redux状态管理的类型安全和空值检查
  - 优化错误处理和用户友好的错误提示
- 🛡️ **数据类型安全** - 增强前端类型系统
  - 统一前后端API接口定义
  - 添加数据格式适配器
  - 增强Redux reducer的安全性检查

### 新增
- 🏷️ **标签系统** - JSON格式标签存储和显示
  - 支持自定义标签的创建和编辑
  - JSON格式标签的自动转换和解析
  - 标签在资产列表中的美观显示
- 🎨 **前端基础界面** - React + Ant Design管理界面
  - 登录页面和用户认证流程
  - 用户管理界面（列表、创建、编辑、删除）
  - 资产管理界面（列表、创建、编辑、删除）
  - 响应式布局和导航系统
- 📖 **前端开发指南** - 详细的前端开发文档
  - 技术栈和项目结构说明
  - 数据流架构和状态管理
  - 常见问题解决方案
  - 开发指南和部署说明
- 🔐 **前端权限系统** - 完整的基于角色的访问控制
  - PermissionGuard组件保护页面访问
  - 基于角色的动态菜单显示
  - 统一的权限检查工具函数
  - 友好的403错误页面

### 修复
- 🔧 **React Router升级** - 修复React Router v6废弃警告
  - 添加v7_relativeSplatPath和v7_startTransition future flags
- 🔧 **前后端数据格式适配** - 修复数据结构不一致问题
  - 统一API响应格式处理
  - 用户状态数字与字符串转换
- 🔧 **图标导入修复** - 修复不存在的Ant Design图标导入
  - 将TerminalOutlined替换为ConsoleSqlOutlined
- 🔧 **API端点路径修正** - 确保前后端API路径一致
  - 登出API：/logout（非/auth/logout）
  - 用户资料API：/profile（非/auth/profile）
  - 修改密码API：/change-password（非/auth/change-password）
- 🔧 **用户体验优化** - 解决权限相关的用户体验问题
  - 修复用户登录后显示"User"而非实际用户名的问题
  - 消除非管理员用户的403错误提示
  - 优化权限检查逻辑，避免不必要的API调用

### 文档更新
- 📖 **README.md** - 更新项目状态和前端开发进展
- 📖 **项目进度总结** - 添加前端开发系统章节
- 📖 **API使用指南** - 确认API端点路径正确性

### 改进
- ⚡ **导航菜单优化** - 更新左侧导航结构
  - "会话管理" → "远程连接"，更直观的功能描述
  - 添加GlobalOutlined图标，突出远程连接特性
- 🧩 **组件复用优化** - 提高代码质量和维护性
  - 创建可复用的连接测试服务（connectionTest.ts）
  - 实现统一的凭证选择组件（CredentialSelector）
  - 添加最近连接管理Hook（useRecentConnections）

### 计划中
- 🔧 集成测试 - 完整功能测试和性能测试
- 📖 文档完善 - 部署文档和使用手册
- 🎯 数据库连接支持 - 扩展到数据库远程连接

## [2.0.0] - 2025-01-13

### 新增
- 🚀 **SSH访问代理系统** - 完整的SSH协议代理实现
  - SSH会话管理和连接池
  - WebSocket支持的实时终端
  - SSH密钥生成和管理
  - 自动清理和状态监控
- 📊 **审计系统** - 全面的操作审计和日志记录
  - 登录日志记录
  - 操作日志记录
  - SSH会话记录
  - 命令执行日志
  - 统计分析功能
- 🖥️ **资产管理模块** - 安全的资产和凭证管理
  - 资产CRUD操作
  - AES-GCM加密的凭证存储
  - 连接测试功能
  - 资产分组管理
- 🔐 **权限系统扩展** - 新增SSH和审计相关权限
  - SSH会话管理权限
  - 审计日志访问权限
  - 凭证管理权限
- 🗄️ **数据库扩展** - 新增审计和SSH相关表结构
  - login_logs表
  - operation_logs表
  - session_records表
  - command_logs表
  - sessions表

### 修复
- 🔧 **AES加密密钥错误** - 修复密钥长度从29字节到32字节
- 🐛 **编译错误修复** - 解决各种技术问题和依赖冲突
- 🔒 **权限验证完善** - 完善的权限检查和访问控制

### 改进
- ⚡ **性能优化** - SSH连接池和审计系统优化
- 📚 **API文档** - 完整的Swagger文档更新
- 🛡️ **安全增强** - 多层次的安全控制和加密保护

### 测试
- ✅ **功能测试** - 所有核心功能测试通过
- ✅ **集成测试** - 各模块集成测试正常
- ✅ **安全测试** - 加密、权限、认证测试通过
- ✅ **实际环境测试** - 真实服务器连接测试通过

## [1.5.0] - 2025-01-12

### 新增
- 👥 **用户管理模块** - 完整的用户管理功能
  - 用户CRUD操作
  - 角色分配和管理
  - 权限系统重构
- 🔑 **权限系统重构** - 从JSON字段重构为独立表结构
  - 独立权限表设计
  - 角色权限关联表
  - 17个系统权限定义
- 📋 **角色管理** - 完整的角色管理功能
  - 角色CRUD操作
  - 权限分配和移除
  - 软删除支持

### 修复
- 🐛 **SQL错误修复** - 解决JSON字段查询导致的SQL错误
- 🔧 **数据一致性** - 使用数据库事务保证数据一致性

### 改进
- ⚡ **查询性能优化** - 权限检查性能提升
- 📚 **API文档完善** - 所有主要接口的详细文档

## [1.0.0] - 2025-01-01

### 新增
- 🎉 **项目正式启动**
- 🏗️ **基础架构搭建** - Go + Gin + GORM + MySQL + Redis
- 🔐 **用户认证系统** - JWT认证和密码安全
- 🗄️ **数据库系统** - 完整的数据库设计和初始化
- 📖 **API文档系统** - Swagger集成和在线调试
- 📋 **完整的需求分析文档**
- 🚀 **MVP快速开始指南**
- 📊 **项目架构图表集**
- ✅ **任务需求一致性检查表**

### 技术特性
- 🔒 **安全特性** - JWT令牌、密码哈希、跨域控制
- 🏗️ **架构设计** - 分层架构、服务层分离
- 📊 **配置管理** - 集中化配置文件系统
- 🗄️ **数据库优化** - 索引优化、连接池配置

### 计划中
- 🔐 用户认证与权限管理系统
- 🖥️ 服务器资产管理功能
- 🔗 SSH访问代理和WebSSH终端
- 📊 操作审计和会话记录

---

### 版本说明
- **v2.0.0**: 核心后端功能完成 - 包含资产管理、SSH代理和审计系统
- **v1.5.0**: 用户管理模块完成 - 完整的用户和权限管理
- **v1.0.0**: 项目基础架构完成 - 认证系统和数据库设计

### 当前系统能力
- ✅ 完整的用户认证和权限管理
- ✅ 资产管理和凭证加密存储
- ✅ SSH代理和会话管理
- ✅ 全面的审计追踪能力
- ✅ REST API和Swagger文档
- ✅ 数据库结构和权限配置
- ✅ 安全的加密和权限控制

系统现已具备完整的后端功能，可以安全地管理用户、资产和SSH访问，并提供全面的审计追踪。下一步将开发前端界面，为用户提供友好的Web管理界面。 