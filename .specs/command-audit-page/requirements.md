# 命令审计页面对接后端实现 - 需求规格说明

## 概述
实现命令审计页面与后端API的完整对接，确保前端能够正确展示命令执行记录、支持搜索过滤、查看详情等功能。目前前端页面组件已经存在，但需要确保与后端API的数据交互正常工作。

## 用户故事
作为系统管理员，我希望能够通过命令审计页面查看所有用户执行的命令记录，以便进行安全审计和问题排查。

## 接受标准（EARS格式）
1. WHEN 用户访问命令审计页面时，系统SHALL 显示所有命令执行记录的分页列表
2. IF 用户输入搜索条件（主机ID、操作用户、命令内容），THEN 系统SHALL 返回匹配的命令记录
3. WHILE 用户查看命令详情时，系统SHALL 显示完整的命令信息包括执行输出
4. WHEN 命令列表数据加载时，系统SHALL 显示加载状态并在失败时给出错误提示
5. IF 后端API返回错误，THEN 前端SHALL 显示友好的错误信息

## 功能需求
### 命令日志列表展示
- 展示命令执行记录的表格，包含：用户名、命令、资产ID、账号ID、会话ID、执行时间
- 支持分页功能，每页默认显示20条记录
- 支持按执行时间倒序排列

### 搜索和过滤功能
- 支持按主机ID搜索（精确匹配）
- 支持按操作用户搜索（模糊匹配）
- 支持按命令内容搜索（模糊匹配）
- 提供搜索重置功能

### 命令详情查看
- 点击详情按钮查看完整命令信息
- 显示详细信息：用户名、会话ID、资产ID、退出码、执行时间、开始时间、结束时间
- 显示完整的执行命令和执行输出
- 支持命令和输出内容的复制功能

### API集成需求
- 正确调用 GET /api/audit/command-logs 获取命令日志列表
- 正确调用 GET /api/audit/command-logs/:id 获取命令详情
- 处理API响应的统一格式（后端已完成统一格式改造）
- 正确处理错误响应和异常情况

### 后端API统一格式说明
根据已完成的后端API统一格式改造：
- 成功响应格式：`{ success: true, data: {...} }`
- 分页响应格式：`{ success: true, data: { items: [...], page: 1, page_size: 20, total: 100, total_pages: 5 } }`
- 错误响应格式：`{ success: false, error: "错误信息" }`
- 审计控制器（audit_controller.go）已使用统一响应辅助函数
- 前端已有响应适配器（responseAdapter.ts）支持格式转换

## 非功能需求
### 性能需求
- 页面加载时间：< 2秒
- API响应时间：< 1秒
- 表格滚动流畅，支持大量数据

### 安全需求
- 仅授权用户可访问命令审计页面
- API调用需要包含有效的认证token
- 敏感命令输出应适当处理

### 用户体验需求
- 加载状态明确可见
- 错误信息友好且有指导性
- 表格支持横向滚动以适应小屏幕
- 命令和输出使用等宽字体显示

## 约束条件
### 技术约束
- 使用React + TypeScript + Ant Design框架
- 遵循现有的API服务架构（BaseApiService）
- 保持与其他审计页面的一致性
- 使用现有的响应适配器（responseAdapter.ts）处理API响应
- 后端API响应格式遵循统一标准（RespondWithPagination/RespondWithData）

### 业务约束
- 命令日志数据不可编辑或删除
- 必须保留完整的审计记录
- 遵守数据保留政策

## 风险评估
### 技术风险
- API响应数据格式不一致 - 概率：低，影响：高（后端已统一格式）
- 大量数据导致性能问题 - 概率：低，影响：中
- 网络错误导致数据加载失败 - 概率：中，影响：中
- 前端适配器兼容性问题 - 概率：低，影响：中

### 缓解策略
- API响应格式不一致：使用现有的responseAdapter.ts进行格式适配
- 性能问题：实现虚拟滚动或增加分页大小选项
- 网络错误：实现重试机制和离线提示
- 适配器兼容性：测试并更新适配器以支持审计日志特定格式