# 命令审计批量删除功能 - 实现计划

## 最新进度
**当前状态**: Completed
**当前任务**: 所有任务已完成
**最后更新**: 2025-08-01

## 任务列表

- [x] 1. 后端API接口开发
  - [x] 1.1 在audit_controller.go中添加BatchDeleteCommandLogs方法
    - 实现批量删除命令日志的控制器方法
    - 添加参数验证和权限检查
    - _需求: 4.1, 4.2_
  - [x] 1.2 在路由配置中注册批量删除接口
    - 在router.go中添加POST /api/audit/command-logs/batch-delete路由
    - 确保路由使用正确的中间件
    - _需求: 4.1_
  - [x] 1.3 实现批量删除的数据库操作
    - 在command_log_service.go中添加BatchDelete方法
    - 使用事务确保批量删除的原子性
    - 记录删除操作到操作日志
    - _需求: 4.3, 4.4_

- [x] 2. 前端API服务层更新
  - [x] 2.1 在AuditApiService.ts中添加批量删除方法
    - 实现batchDeleteCommandLogs方法
    - 添加TypeScript类型定义
    - _需求: 4.1_
  - [x] 2.2 在auditAPI.ts中导出批量删除方法
    - 添加静态方法batchDeleteCommandLogs
    - 确保方法签名与其他批量删除API一致
    - _需求: 4.1_

- [x] 3. 命令日志表格组件改造
  - [x] 3.1 添加批量选择状态管理
    - 在CommandLogsTable组件中添加selectedRowKeys状态
    - 添加setSelectedRowKeys状态更新函数
    - _需求: 1.1_
  - [x] 3.2 配置表格的rowSelection属性
    - 启用表格的行选择功能
    - 配置选择框的onChange事件处理
    - 设置preserveSelectedRowKeys为true
    - _需求: 1.1, 1.2_
  - [x] 3.3 实现批量删除功能
    - 添加handleBatchDelete异步函数
    - 实现删除确认和API调用逻辑
    - 处理成功和失败的响应
    - _需求: 3.3, 5.1_

- [x] 4. UI组件添加和样式调整
  - [x] 4.1 添加批量删除按钮组件
    - 在表格下方添加批量删除按钮
    - 设置按钮的位置样式(marginTop: -40px)
    - 显示选中记录数量
    - _需求: 2.1, 2.3, 2.4_
  - [x] 4.2 集成Popconfirm确认对话框
    - 包装批量删除按钮with Popconfirm
    - 设置确认提示文本
    - 配置确认和取消的回调函数
    - _需求: 3.1, 3.2_
  - [x] 4.3 添加加载状态管理
    - 添加batchDeleting状态变量
    - 在删除过程中显示loading状态
    - 完成后恢复按钮状态
    - _需求: 5.1, 5.2, 5.3_

- [ ] 5. 集成测试和调试
  - [ ] 5.1 测试批量选择功能
    - 验证全选/反选功能正常
    - 确认选中状态的视觉反馈
    - 测试跨页选择的行为
    - _需求: 1.1, 1.2, 1.3_
  - [ ] 5.2 测试批量删除流程
    - 测试正常删除场景
    - 测试取消删除的行为
    - 验证删除后列表自动刷新
    - _需求: 3.3, 3.4, 5.4_
  - [ ] 5.3 测试错误处理
    - 测试网络错误的处理
    - 测试权限不足的场景
    - 验证错误消息的显示
    - _需求: 5.4_

- [ ] 6. 代码优化和文档更新
  - [ ] 6.1 优化组件性能
    - 使用React.useCallback优化事件处理函数
    - 确保组件不会不必要的重新渲染
    - _需求: 5.2_
  - [ ] 6.2 更新相关文档
    - 更新API文档说明新增的批量删除接口
    - 添加功能使用说明
    - _需求: 4.1_

## 进度摘要
- **总任务数**: 17
- **已完成**: 11
- **进行中**: 0