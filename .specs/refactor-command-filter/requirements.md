# 命令过滤功能重构 - 需求规格说明书

## 概述
对现有命令过滤功能进行全面重构，完全移除现有实现并重新设计。新系统只保留命令组和命令过滤两个核心功能模块，实现更简洁高效的命令权限控制。

## 用户故事
作为系统管理员，我希望使用全新设计的命令过滤功能，通过简化的界面管理命令组和过滤规则，实现对用户命令执行权限的精确控制。

## 验收标准（EARS格式）
1. WHEN 用户访问命令过滤页面时，系统 SHALL 只显示"命令过滤"和"命令组"两个功能标签
2. IF 用户创建命令组时，THEN 系统应支持设置名称、类型（命令/正则表达式）、内容和备注
3. WHILE 用户配置命令过滤规则时，系统 SHALL 允许指定用户、资产、账号，并选择命令组和动作（拒绝/接受/告警/提示并告警）
4. WHEN 系统重构开始前，系统 SHALL 清空所有现有数据，包括系统预设的危险命令组
5. WHEN 现有功能被移除后，系统 SHALL 实现全新的命令过滤功能设计

## 功能需求

### 1. 现有功能完全移除
- 删除现有的所有命令过滤相关代码和数据表
- 清空所有数据，包括：
  - 用户创建的测试数据
  - 系统预设的危险命令组
  - 所有命令、命令组、策略等相关数据
- 移除"命令"和"策略"功能模块

### 2. 命令组管理（全新设计）
- **基本信息**：
  - 名称（必填，唯一标识）
  - 备注（选填，功能说明）
- **命令配置**：
  - 类型选择：
    - 命令：精确匹配具体命令
    - 正则表达式：支持模式匹配
  - 内容输入：
    - 支持多行输入
    - 命令类型：每行一个命令
    - 正则类型：每行一个正则表达式
  - 忽略大小写：可选开关
- **管理功能**：
  - 新增命令组
  - 编辑命令组
  - 删除命令组
  - 命令组列表展示（支持分页和搜索）

### 3. 命令过滤管理（全新设计）
- **基本设置**：
  - 名称（必填，描述规则用途）
  - 优先级（1-100，默认50，数字越小优先级越高）
  - 激活状态：启用/禁用开关
- **过滤目标配置**：
  - **用户选择**：
    - 全部用户：应用于所有用户
    - 指定用户：通过穿梭框选择特定用户
    - 属性筛选：支持按部门、角色等属性过滤
  - **资产选择**：
    - 全部资产：应用于所有资产
    - 指定资产：通过穿梭框选择特定资产
    - 属性筛选：支持按资产组、类型等属性过滤
  - **账号选择**：
    - 所有账号：应用于所有账号
    - 指定账号：输入具体账号名称（如root）
- **命令组关联**：
  - 从已创建的命令组中选择
  - 支持搜索和下拉选择
- **动作配置**：
  - 拒绝：阻止命令执行
  - 接受：允许命令执行
  - 告警：记录告警日志但允许执行
  - 提示并告警：向用户显示警告信息并记录日志
- **其他设置**：
  - 备注：填写规则说明

### 4. 列表展示优化
- **命令组列表**：
  - 显示：ID、名称、命令数量、类型、创建时间
  - 操作：编辑、删除
  - 支持按名称搜索
- **命令过滤列表**：
  - 显示：ID、名称、优先级、状态、关联用户/资产/账号数量、动作、创建时间
  - 操作：编辑、删除、启用/禁用
  - 支持按名称搜索

## 非功能需求

### 性能需求
- 页面加载时间 < 2秒
- 命令匹配响应时间 < 100ms
- 支持管理10000+条过滤规则

### 安全需求
- 管理员权限验证
- 操作审计日志
- 防止SQL注入和XSS攻击

### 用户体验
- 简洁直观的界面设计
- 清晰的操作反馈
- 友好的错误提示

## 约束条件

### 技术约束
- 前端：React + TypeScript + Ant Design
- 后端：Go (Gin框架)
- 数据库：MySQL
- 保持与现有系统架构兼容

### 业务约束
- 重构期间需要保证系统其他功能正常运行
- 提供数据备份和恢复方案

## 风险评估

### 技术风险
- 数据清理可能影响正在使用的规则 - 概率：高，影响：高
- 新旧系统切换可能导致服务中断 - 概率：中，影响：高
- 功能重构可能引入新的安全漏洞 - 概率：低，影响：高

### 缓解策略
- 数据清理：执行前完整备份，提供快速恢复方案
- 系统切换：采用灰度发布，逐步切换
- 安全测试：进行完整的安全审计和渗透测试