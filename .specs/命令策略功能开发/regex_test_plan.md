# 正则表达式匹配测试计划

## 测试目标
验证命令策略服务中的正则表达式匹配功能是否正确工作，包括：
1. 基本正则表达式匹配
2. 复杂模式匹配
3. 边界条件处理
4. 性能测试
5. 错误处理

## 测试环境准备
- 数据库已连接：MySQL (10.0.0.7)
- 后端服务运行在端口 8080
- 测试用户ID: 1 (admin)

## 测试用例设计

### 1. 基础正则表达式测试

#### 1.1 简单模式匹配
| 测试ID | 正则表达式 | 测试命令 | 预期结果 | 说明 |
|--------|------------|----------|----------|------|
| R001 | `rm.*` | `rm file.txt` | 匹配 | 删除命令模式 |
| R002 | `rm.*` | `remove file.txt` | 不匹配 | 不同命令 |
| R003 | `sudo.*` | `sudo apt install` | 匹配 | sudo命令模式 |
| R004 | `^ls$` | `ls` | 匹配 | 精确匹配ls |
| R005 | `^ls$` | `ls -la` | 不匹配 | 带参数的ls |

#### 1.2 字符类和量词测试
| 测试ID | 正则表达式 | 测试命令 | 预期结果 | 说明 |
|--------|------------|----------|----------|------|
| R006 | `rm\s+-[rf]+` | `rm -rf /tmp` | 匹配 | 危险删除选项 |
| R007 | `rm\s+-[rf]+` | `rm -l file` | 不匹配 | 安全删除选项 |
| R008 | `cat\s+/etc/passwd` | `cat /etc/passwd` | 匹配 | 敏感文件访问 |
| R009 | `\w+\s+/etc/(passwd|shadow|group)` | `vim /etc/shadow` | 匹配 | 多个敏感文件 |
| R010 | `[0-9]+\.[0-9]+\.[0-9]+\.[0-9]+` | `ping 192.168.1.1` | 匹配 | IP地址模式 |

#### 1.3 锚点和边界测试
| 测试ID | 正则表达式 | 测试命令 | 预期结果 | 说明 |
|--------|------------|----------|----------|------|
| R011 | `^shutdown` | `shutdown -h now` | 匹配 | 命令开头匹配 |
| R012 | `^shutdown` | `sudo shutdown -h now` | 不匹配 | 不在开头 |
| R013 | `reboot$` | `sudo reboot` | 匹配 | 命令结尾匹配 |
| R014 | `reboot$` | `reboot now` | 不匹配 | 不在结尾 |

### 2. 复杂场景测试

#### 2.1 路径和文件操作
| 测试ID | 正则表达式 | 测试命令 | 预期结果 | 说明 |
|--------|------------|----------|----------|------|
| R015 | `rm\s+.*/(bin|sbin|etc|usr)` | `rm -rf /usr/local` | 匹配 | 系统目录删除 |
| R016 | `chmod\s+[0-7]{3,4}\s+/` | `chmod 777 /tmp/file` | 匹配 | 权限修改 |
| R017 | `.*\s+>\s*/dev/(null|zero)` | `echo test > /dev/null` | 匹配 | 输出重定向 |

#### 2.2 网络和系统命令
| 测试ID | 正则表达式 | 测试命令 | 预期结果 | 说明 |
|--------|------------|----------|----------|------|
| R018 | `(wget|curl).*http` | `wget http://example.com` | 匹配 | 网络下载 |
| R019 | `netstat\s+.*-[a-z]*p` | `netstat -anp` | 匹配 | 进程网络信息 |
| R020 | `ps\s+.*-[a-z]*e` | `ps -ef` | 匹配 | 进程环境信息 |

### 3. 边界条件测试

#### 3.1 特殊字符处理
| 测试ID | 正则表达式 | 测试命令 | 预期结果 | 说明 |
|--------|------------|----------|----------|------|
| R021 | `grep\s+.*[\$\*\[\]]` | `grep "test*" file` | 匹配 | 特殊字符 |
| R022 | `find.*-exec.*\;` | `find . -exec rm {} \;` | 匹配 | find执行命令 |
| R023 | `.*\|\|.*rm` | `ls /tmp || rm file` | 匹配 | 命令链组合 |

#### 3.2 大小写敏感测试
| 测试ID | 正则表达式 | 测试命令 | 预期结果 | 说明 |
|--------|------------|----------|----------|------|
| R024 | `(?i)SHUTDOWN` | `shutdown now` | 匹配 | 不区分大小写 |
| R025 | `SHUTDOWN` | `shutdown now` | 不匹配 | 区分大小写 |

### 4. 性能测试

#### 4.1 复杂正则性能
| 测试ID | 正则表达式 | 描述 | 性能要求 |
|--------|------------|------|----------|
| P001 | `^(sudo\s+)?(rm\|mv\|cp)\s+.*` | 多命令组合 | <1ms |
| P002 | `.*/(bin\|sbin\|usr\|etc\|var)/.*` | 路径匹配 | <1ms |
| P003 | `(wget\|curl).*\.(exe\|sh\|pl\|py)$` | 下载脚本检测 | <1ms |

### 5. 错误处理测试

#### 5.1 无效正则表达式
| 测试ID | 正则表达式 | 预期行为 | 说明 |
|--------|------------|----------|------|
| E001 | `[abc` | 编译错误 | 未闭合字符类 |
| E002 | `*abc` | 编译错误 | 无效量词 |
| E003 | `(?P<>abc)` | 编译错误 | 无效组名 |

## 测试执行计划

### 阶段1：基础功能验证
1. 创建测试命令和策略
2. 执行基础正则测试用例 (R001-R014)
3. 验证匹配结果准确性

### 阶段2：复杂场景测试
1. 执行复杂场景测试 (R015-R020)
2. 验证边界条件处理 (R021-R025)
3. 检查日志记录完整性

### 阶段3：性能和稳定性测试
1. 执行性能测试 (P001-P003)
2. 测试错误处理 (E001-E003)
3. 并发访问测试

## 验收标准
1. ✅ 所有基础正则测试用例通过率 ≥ 95%
2. ✅ 复杂场景测试准确匹配
3. ✅ 单次匹配响应时间 < 10ms
4. ✅ 无效正则表达式正确报错
5. ✅ 缓存机制正常工作
6. ✅ 拦截日志正确记录

## 测试结果记录
测试完成后，结果将记录在 `test-report-6.2.md` 文件中。