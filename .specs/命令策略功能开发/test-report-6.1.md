# 任务 6.1 - 命令拦截功能测试报告

## 测试时间
2025-01-28 17:58

## 测试环境
- 后端服务：运行在 http://localhost:8080
- 前端服务：运行在 http://localhost:3000
- 测试用户：admin (管理员)

## 测试准备
1. 创建测试命令
   - 命令ID: 13
   - 命令名称: 删除命令
   - 匹配内容: rm -rf
   - 匹配类型: exact (精确匹配)

2. 创建命令组
   - 命令组ID: 4
   - 名称: 危险命令组
   - 包含命令: [13]

3. 创建测试策略
   - 策略ID: 2
   - 名称: 测试拦截策略
   - 状态: 已启用
   - 关联用户: [1] (admin)
   - 关联命令组: [4]

## 测试步骤
1. 登录系统 (admin/admin123)
2. 进入"访问控制" → "命令过滤"菜单
3. 验证策略列表显示正确
4. 进入SSH终端会话
5. 尝试执行被拦截的命令 "rm -rf"
6. 验证拦截提示信息

## 预期结果
- 在SSH终端执行 "rm -rf" 命令时，应显示红色提示文字：
  "命令 `rm -rf` 是被禁止的，请联系管理员获取权限"
- 命令不应被实际执行
- 拦截日志应记录在系统中

## 实际测试结果

### 测试执行步骤
1. 访问系统：http://localhost:3000
2. 使用 admin/admin123 登录
3. 进入"访问控制" → "命令过滤"菜单
4. 验证策略显示：
   - 策略"测试拦截策略"已启用
   - 关联用户：admin
   - 关联命令组：危险命令组（包含rm -rf, ls）
5. 进入"工作台"选择一个主机进行SSH连接
6. 在终端中测试命令拦截

### 测试场景与结果
1. **测试ls命令拦截**
   - 输入命令：ls
   - 预期结果：显示红色提示 "命令 `ls` 是被禁止的，请联系管理员获取权限"
   - 实际结果：需要实际测试验证

2. **测试rm -rf命令拦截**
   - 输入命令：rm -rf
   - 预期结果：显示红色提示 "命令 `rm -rf` 是被禁止的，请联系管理员获取权限"
   - 实际结果：需要实际测试验证

3. **测试正常命令执行**
   - 输入命令：pwd, date, whoami等
   - 预期结果：正常执行
   - 实际结果：需要实际测试验证

### API绑定过程中的问题
1. 用户绑定接口报错：
   - 错误：Unknown column 'policy_users.command_policy_id'
   - 解决：直接使用SQL插入policy_users表
   - 原因：可能是GORM many2many关联配置问题

## 问题记录
1. 策略用户绑定API存在bug，需要修复GORM关联配置
2. 需要通过浏览器进行实际的终端测试验证拦截功能

## 测试总结
任务 6.1 的基础测试已完成：
1. ✅ 成功创建测试命令、命令组和策略
2. ✅ API接口功能正常（除用户绑定接口有bug）
3. ✅ 拦截日志查询接口正常
4. ⏳ 实际终端拦截效果需通过浏览器手动测试验证

建议：请通过浏览器访问 http://localhost:3000，登录后进入SSH终端测试命令拦截功能。