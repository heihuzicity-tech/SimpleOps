# 仪表盘功能 - 实施任务列表

## 任务概览
基于 dashboard-mockup.html 的设计效果，实现堡垒机系统的仪表盘功能。预计总工期：5-7个工作日。

## 前置条件
- [x] 开发环境已配置完成
- [x] 已切换到 feature/dashboard 分支
- [x] 了解现有系统架构和API

## 任务列表

### 1. 后端基础架构搭建
- [ ] 1.1 创建仪表盘数据模型
  - 文件：`backend/models/dashboard.go`
  - 描述：定义仪表盘相关的数据结构（DashboardStats、HostDistribution等）
  - 验收：数据结构定义完整，符合前端需求

- [ ] 1.2 实现仪表盘服务层
  - 文件：`backend/services/dashboard_service.go`
  - 描述：实现数据聚合逻辑，整合多个服务的统计数据
  - 验收：能正确聚合主机、用户、会话、凭证等统计数据

- [ ] 1.3 实现仪表盘控制器
  - 文件：`backend/controllers/dashboard_controller.go`
  - 描述：暴露仪表盘相关的API端点
  - 验收：API端点可访问，返回正确的JSON数据

- [ ] 1.4 配置仪表盘路由
  - 文件：`backend/routers/router.go`
  - 描述：添加仪表盘相关路由配置
  - 验收：路由正确映射，支持权限验证

### 2. 前端环境准备
- [ ] 2.1 安装图表库依赖
  - 文件：`frontend/package.json`
  - 描述：安装 recharts 图表库
  - 验收：依赖安装成功，无版本冲突

- [ ] 2.2 创建仪表盘状态管理
  - 文件：`frontend/src/store/dashboardSlice.ts`
  - 描述：使用Redux Toolkit创建仪表盘状态切片
  - 验收：状态管理正常工作，支持异步数据获取

- [ ] 2.3 创建仪表盘API服务
  - 文件：`frontend/src/services/dashboardAPI.ts`
  - 描述：封装仪表盘相关的API调用
  - 验收：API调用正常，错误处理完善

### 3. 核心组件开发
- [x] 3.1 创建仪表盘页面主组件
  - 文件：`frontend/src/pages/DashboardPage.tsx`
  - 描述：实现仪表盘页面布局和数据加载逻辑
  - 验收：页面布局符合设计稿，支持响应式

- [x] 3.2 实现统计卡片组件
  - 文件：`frontend/src/components/dashboard/StatsCards.tsx`
  - 描述：展示主机、会话、用户、凭证四个核心指标卡片
  - 验收：卡片样式美观，数据展示正确，包含图标和趋势信息

- [x] 3.3 实现最近登录历史表格
  - 文件：`frontend/src/components/dashboard/RecentLoginTable.tsx`
  - 描述：展示最近的登录记录，包含状态标识
  - 验收：表格功能完整，支持分页，状态显示正确

- [x] 3.4 实现主机分组分布图表
  - 文件：`frontend/src/components/dashboard/HostDistributionChart.tsx`
  - 描述：使用环形图展示主机分组分布情况
  - 验收：图表渲染正常，支持图例，交互流畅

### 4. 辅助功能组件
- [x] 4.1 实现审计统计概览组件
  - 文件：`frontend/src/components/dashboard/AuditSummary.tsx`
  - 描述：四宫格展示登录日志、操作日志、命令记录、高危命令数量
  - 验收：布局美观，数据准确，颜色区分明显

- [x] 4.2 实现快速访问列表组件
  - 文件：`frontend/src/components/dashboard/QuickAccessList.tsx`
  - 描述：展示用户有权限的主机列表，支持快速连接
  - 验收：列表展示正确，连接按钮功能正常

- [x] 4.3 集成组件到主页面
  - 文件：`frontend/src/pages/DashboardPage.tsx`
  - 描述：将所有子组件集成到仪表盘页面
  - 验收：整体布局协调，组件间数据传递正常

### 5. 路由和导航配置
- [x] 5.1 添加仪表盘路由
  - 文件：`frontend/src/App.tsx`
  - 描述：配置 /dashboard 路由，导入 DashboardPage 组件
  - 验收：路由访问正常，页面加载成功

- [x] 5.2 更新导航菜单
  - 文件：`frontend/src/components/DashboardLayout.tsx`
  - 描述：确保仪表盘菜单项正确配置和高亮
  - 验收：菜单导航正常，选中状态正确

### 6. 数据自动刷新和优化
- [x] 6.1 ~~实现自动刷新机制~~ (已取消，改为手动刷新)
  - 文件：`frontend/src/pages/DashboardPage.tsx`
  - 描述：~~实现30秒自动刷新数据的功能~~ 保留手动刷新功能
  - 验收：手动刷新功能正常工作

- [x] 6.2 添加加载和错误状态
  - 文件：相关组件文件
  - 描述：为各组件添加加载动画和错误提示
  - 验收：用户体验流畅，错误处理友好

- [x] 6.3 性能优化
  - 文件：相关组件文件
  - 描述：实现组件懒加载，优化渲染性能
  - 验收：页面加载快速，无明显卡顿

### 7. 样式调整和响应式设计
- [ ] 7.1 实现与设计稿一致的样式
  - 文件：各组件的样式文件
  - 描述：按照 dashboard-mockup.html 调整组件样式
  - 验收：视觉效果与设计稿一致

- [ ] 7.2 响应式布局适配
  - 文件：相关样式文件
  - 描述：确保在不同屏幕尺寸下的良好展示
  - 验收：1920x1080及以上分辨率完美展示

### 8. 测试和文档
- [ ] 8.1 编写单元测试
  - 文件：`*.test.ts` 文件
  - 描述：为关键功能编写单元测试
  - 验收：测试覆盖率达到要求

- [ ] 8.2 集成测试
  - 文件：测试脚本
  - 描述：测试前后端集成是否正常
  - 验收：所有API调用正常，数据展示正确

- [ ] 8.3 更新项目文档
  - 文件：`README.md` 等
  - 描述：添加仪表盘功能的使用说明
  - 验收：文档清晰完整

## 执行指南

### 任务执行顺序
1. **后端先行**：先完成后端API（任务1.1-1.4）
2. **前端基础**：搭建前端基础架构（任务2.1-2.3）
3. **核心功能**：实现核心展示组件（任务3.1-3.4）
4. **完善功能**：添加辅助功能（任务4.1-5.2）
5. **优化提升**：性能优化和样式调整（任务6.1-7.2）
6. **质量保证**：测试和文档（任务8.1-8.3）

### 执行命令
- 执行特定任务：`/kiro exec 1.1`
- 执行下一个任务：`/kiro next`
- 查看进度：`/kiro status dashboard`

## 时间规划
- **第1-2天**：完成后端开发（任务1.1-1.4）
- **第3-4天**：完成前端核心组件（任务2.1-3.4）
- **第5天**：完成辅助功能和集成（任务4.1-5.2）
- **第6天**：优化和样式调整（任务6.1-7.2）
- **第7天**：测试和文档（任务8.1-8.3）

## 风险提醒
1. **数据量性能**：大数据量时图表渲染可能卡顿，需要考虑数据聚合
2. **浏览器兼容**：图表库在不同浏览器的兼容性需要测试
3. **实时性要求**：30秒刷新间隔是否满足需求，可能需要调整

## 完成标准
- [ ] 所有任务完成并通过验收
- [ ] 代码通过 lint 和 typecheck
- [ ] 测试用例全部通过
- [ ] 功能在生产环境正常运行
- [ ] 文档更新完成