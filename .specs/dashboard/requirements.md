# 仪表盘功能 - 需求规格说明书

## 概述
为堡垒机系统构建一个综合性的仪表盘页面，提供系统运行状态的可视化展示，帮助管理员快速了解系统使用情况、主机资源状态和安全态势。

## 用户故事
1. 作为系统管理员，我希望能够在仪表盘上快速查看系统的整体运行状态，包括在线用户数、活跃会话数等关键指标
2. 作为系统管理员，我希望能够查看资产的使用情况和分布，以便合理分配和管理资源
3. 作为系统管理员，我希望能够监控系统的安全状况，及时发现异常登录和高危操作
4. 作为运维人员，我希望能够查看最近的连接记录和热门资产，方便快速访问常用资源

## 验收标准（EARS格式）
1. WHEN 用户访问仪表盘页面时，系统 SHALL 在2秒内加载并显示所有统计数据
2. IF 用户角色是管理员，THEN 仪表盘 SHALL 显示完整的系统统计信息和所有用户的活动数据
3. IF 用户角色是普通用户，THEN 仪表盘 SHALL 仅显示该用户个人的使用统计和授权资产信息
4. WHILE 用户停留在仪表盘页面，系统 SHALL 每30秒自动刷新一次实时数据
5. WHEN 系统检测到异常登录或高危命令时，仪表盘 SHALL 在显著位置展示告警信息

## 功能需求

### 1. 核心统计卡片区
展示系统的关键统计指标，使用卡片形式呈现：
- **主机统计**：主机总数、分组数量
- **会话统计**：在线会话数、历史会话总数（实时更新）
- **用户统计**：总用户数、在线用户数
- **凭证统计**：密码凭证数、SSH密钥凭证数

### 2. 最近登录历史表格
展示最近的登录记录，包含以下字段：
- 登录用户
- 资源凭证（如root@10.0.0.7）
- 登录时间
- 执行时长
- 操作按钮（查看详情）

### 3. 主机分布可视化
- **主机分组分布**：环形图展示各分组的主机数量占比
- **主机状态分布**：显示在线、离线、连接中的主机数量
- **操作系统分布**：展示Linux、Windows等系统类型占比

### 4. 用户活跃度分析
- **会话活跃趋势**：折线图展示近7天的会话数量变化趋势
- **用户登录统计**：展示今日、本周、本月的登录次数
- **活跃用户TOP榜**：显示最活跃的前10个用户
- **热门主机TOP榜**：显示最常被访问的前10个主机

### 5. 审计统计概览
- **日志统计数据**：
  - 登录日志数量
  - 操作日志数量  
  - 命令记录总数
  - 会话录屏数量
- **告警统计**：
  - 今日高危命令数
  - 异常登录次数
  - 命令拦截次数

### 6. 快速访问入口
- **我的主机**：展示当前用户有权限访问的主机列表，支持快速连接
- **最近连接**：显示用户最近连接过的5个主机
- **快捷操作**：提供常用功能的快速入口（新建连接、查看审计日志等）

## 非功能需求

### 性能需求
- 页面首次加载时间：< 2秒
- 数据刷新响应时间：< 500ms
- 图表渲染流畅度：≥ 60 FPS
- 支持同时在线用户数：≥ 100

### 安全需求
- **数据权限隔离**：严格按照用户角色和权限展示相应的数据
- **敏感信息处理**：对IP地址、用户名等敏感信息进行适当脱敏展示
- **审计日志**：记录所有仪表盘数据访问和操作行为

### 用户体验需求
- **响应式设计**：支持1920x1080及以上分辨率的最佳展示
- **主题支持**：跟随系统主题（支持亮色/暗色模式）
- **国际化**：支持中英文切换

## 约束条件

### 技术约束
- 前端技术栈：React + TypeScript + Ant Design
- 图表库：优先使用Recharts或ECharts
- 状态管理：使用Redux管理仪表盘数据状态
- API通信：RESTful API + WebSocket（实时数据）

### 业务约束
- 数据范围：仪表盘默认展示最近30天的数据
- 刷新策略：实时数据30秒自动刷新，统计数据5分钟更新一次
- 数据导出：仅管理员可导出仪表盘数据

## 风险评估

### 技术风险
- **大数据量渲染性能问题** - 概率：高，影响：中
  - 缓解策略：实施数据聚合、分页加载、虚拟滚动等优化措施

- **WebSocket连接稳定性** - 概率：中，影响：低  
  - 缓解策略：实现自动重连机制，降级使用轮询方案

### 业务风险
- **数据准确性要求** - 概率：中，影响：高
  - 缓解策略：建立数据校验机制，实施数据一致性检查

## 实施优先级
1. P0：核心统计卡片、最近登录历史
2. P1：资源分布图表、用户活跃度分析
3. P2：审计统计概览、快速访问入口
4. P3：高级筛选、数据导出功能